<form id="surveyForm" method="post">
    {% csrf_token %}
    <label for="title">Title:</label>
    <input type="text" id="title" name="title">
    <div id="questions">
        <div class="question">
            <label for="question1">Question 1:</label>
            <input type="text" id="question1" name="questions">
            <select name="questionTypes" onchange="addOptions(this)">
                <option value="text">Text</option>
                <option value="multiple_choice">Multiple Choice</option>
                <option value="all_that_apply">All that apply</option>
                <!--add any other options here-->
            </select>
            <div class="options"></div>
        </div> 
    </div>
    <button type="button" id="addQuestion">Add Question</button>
    <input type="submit" value="Create Survey">
</form>

<script>
document.getElementById('questions').addEventListener('change', function(event) {
    if (event.target.name === 'questionTypes') {
        addOptions(event.target);
    }
});

document.getElementById('addQuestion').addEventListener('click', function(event) {
    event.preventDefault();
    var questionsDiv = document.getElementById('questions');
    var questionCount = questionsDiv.getElementsByClassName('question').length;
    var newDiv = document.createElement('div');
    newDiv.setAttribute('class', 'question');
    var newLabel = document.createElement('label');
    newLabel.setAttribute('for', 'question' + (questionCount + 1));
    newLabel.textContent = 'Question ' + (questionCount + 1) + ':';
    newLabel.setAttribute('onclick', 'editLabel(this)');
    var newInput = document.createElement('input');
    newInput.setAttribute('type', 'text');
    newInput.setAttribute('id', 'question' + (questionCount + 1));
    newInput.setAttribute('name', 'questions');
    var newSelect = document.createElement('select');
    newSelect.setAttribute('name', 'questionTypes');
    newSelect.setAttribute('onchange', 'addOptions(this)');
    var option1 = document.createElement('option');
    option1.setAttribute('value', 'text');
    option1.textContent = 'Text';
    var option2 = document.createElement('option');
    option2.setAttribute('value', 'multiple_choice');
    option2.textContent = 'Multiple Choice';
    var option3 = document.createElement('option');
    option3.setAttribute('value', 'all_that_apply');
    option3.textContent = 'All that apply';
    newSelect.appendChild(option1);
    newSelect.appendChild(option2);
    newSelect.appendChild(option3);
    var newOptionsDiv = document.createElement('div');
    newOptionsDiv.setAttribute('class', 'options');
    newDiv.appendChild(newLabel);
    newDiv.appendChild(newInput);
    newDiv.appendChild(newSelect);
    newDiv.appendChild(newOptionsDiv);
    questionsDiv.appendChild(newDiv);
});

function addOptions(select) {
    var optionsDiv = select.parentNode.getElementsByClassName('options')[0];
    optionsDiv.innerHTML = '';
    if (select.value == 'multiple_choice') {
        // existing code for multiple_choice
    } else if (select.value == 'all_that_apply') {
        allThatApply(optionsDiv);
    }
}

function allThatApply(optionsDiv) {
    for (var i = 1; i <= 4; i++) {
        var newLabel = document.createElement('label');
        newLabel.textContent = 'Option ' + i + ':';
        newLabel.setAttribute('onclick', 'editLabel(this)');
        var newInput = document.createElement('input');
        newInput.setAttribute('type', 'checkbox');
        newInput.setAttribute('name', 'options');
        optionsDiv.appendChild(newLabel);
        optionsDiv.appendChild(newInput);
    }
    var addButton = document.createElement('button');
    addButton.textContent = 'Add Option';
    addButton.addEventListener('click', function(event) {
        event.preventDefault();
        var newLabel = document.createElement('label');
        newLabel.textContent = 'Option ' + (optionsDiv.getElementsByTagName('input').length + 1) + ':';
        newLabel.setAttribute('onclick', 'editLabel(this)');
        var newInput = document.createElement('input');
        newInput.setAttribute('type', 'checkbox');
        newInput.setAttribute('name', 'options');
        optionsDiv.appendChild(newLabel);
        optionsDiv.appendChild(newInput);
    });
    optionsDiv.appendChild(addButton);
}

function editLabel(label) {
    var newText = prompt('Enter new text for the label:');
    if (newText) {
        label.textContent = newText;
    }
}
</script>